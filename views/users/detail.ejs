<section class="section">
  <div class="row">
    <div class="col-12 col-lg-8 mx-auto">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title">Informasi User</h4>
        </div>
        <div class="card-body">
          <div class="row mb-4">
            <div class="col-md-3 text-center">
              <div class="avatar avatar-xl mb-3">
                <% if (viewUser.profile_photo) { %>
                  <img src="<%= viewUser.profile_photo %>" alt="Avatar" class="rounded-circle" style="width: 120px; height: 120px; object-fit: cover;">
                <% } else { %>
                  <img src="/dashboard-template/dist/assets/images/faces/1.jpg" alt="Avatar" class="rounded-circle" style="width: 120px; height: 120px; object-fit: cover;">
                <% } %>
              </div>
              <% 
                let badgeClass = 'bg-secondary';
                if (viewUser.role_level === 1) badgeClass = 'bg-danger';
                else if (viewUser.role_level === 2) badgeClass = 'bg-primary';
                else if (viewUser.role_level === 3) badgeClass = 'bg-info';
                else if (viewUser.role_level === 4) badgeClass = 'bg-warning';
                else if (viewUser.role_level === 5) badgeClass = 'bg-success';
              %>
              <span class="badge <%= badgeClass %> fs-6"><%= viewUser.role_name %></span>
            </div>
            <div class="col-md-9">
              <table class="table table-borderless">
                <tbody>
                  <tr>
                    <th width="200">Username</th>
                    <td><strong><%= viewUser.username %></strong></td>
                  </tr>
                  <tr>
                    <th>Nama Lengkap</th>
                    <td><%= viewUser.full_name %></td>
                  </tr>
                  <tr>
                    <th>Email</th>
                    <td>
                      <i class="bi bi-envelope"></i> <%= viewUser.email %>
                    </td>
                  </tr>
                  <tr>
                    <th>No. Telepon</th>
                    <td>
                      <% if (viewUser.phone) { %>
                        <i class="bi bi-telephone"></i> <%= viewUser.phone %>
                      <% } else { %>
                        <span class="text-muted">-</span>
                      <% } %>
                    </td>
                  </tr>
                  <tr>
                    <th>Alamat</th>
                    <td>
                      <% if (viewUser.address) { %>
                        <i class="bi bi-geo-alt"></i> <%= viewUser.address %>
                      <% } else { %>
                        <span class="text-muted">-</span>
                      <% } %>
                    </td>
                  </tr>
                  <tr>
                    <th>Role</th>
                    <td><%= viewUser.role_name %></td>
                  </tr>
                  <tr>
                    <th>Status</th>
                    <td>
                      <% if (viewUser.is_active) { %>
                        <span class="badge bg-success">
                          <i class="bi bi-check-circle"></i> Aktif
                        </span>
                      <% } else { %>
                        <span class="badge bg-secondary">
                          <i class="bi bi-x-circle"></i> Tidak Aktif
                        </span>
                      <% } %>
                    </td>
                  </tr>
                  <tr>
                    <th>Terdaftar Sejak</th>
                    <td>
                      <i class="bi bi-calendar-event"></i> 
                      <% if (viewUser.created_at) { %>
                        <%= new Date(viewUser.created_at).toLocaleDateString('id-ID', { 
                          day: 'numeric', 
                          month: 'long', 
                          year: 'numeric' 
                        }) %>
                      <% } else { %>
                        <span class="text-muted">-</span>
                      <% } %>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <hr class="my-4">

          <div class="d-flex justify-content-between">
            <a href="/users" class="btn btn-secondary">
              <i class="bi bi-arrow-left"></i> Kembali
            </a>
            <div>
              <a href="/users/edit/<%= viewUser.id %>" class="btn btn-warning">
                <i class="bi bi-pencil"></i> Edit
              </a>
              <% if (viewUser.id !== locals.session?.userId) { %>
              <button type="button" class="btn btn-danger" onclick="confirmDelete(<%= viewUser.id %>, '<%= viewUser.username %>')">
                <i class="bi bi-trash"></i> Hapus
              </button>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Delete Confirmation Modal -->
<div class="modal fade text-left" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header bg-danger">
        <h5 class="modal-title white" id="deleteModalLabel">
          <i class="bi bi-exclamation-triangle"></i> Konfirmasi Hapus
        </h5>
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <i data-feather="x"></i>
        </button>
      </div>
      <div class="modal-body">
        <p>Apakah Anda yakin ingin menghapus user <strong id="deleteUsername" class="text-danger"></strong>?</p>
        <div class="alert alert-light-warning color-warning">
          <i class="bi bi-info-circle"></i> <strong>Perhatian!</strong> Data yang dihapus tidak dapat dikembalikan!
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-light-secondary" data-bs-dismiss="modal">
          <i class="bx bx-x d-block d-sm-none"></i>
          <span class="d-none d-sm-block">Batal</span>
        </button>
        <form id="deleteForm" method="POST" style="display: inline;">
          <button type="submit" class="btn btn-danger ml-1">
            <i class="bx bx-check d-block d-sm-none"></i>
            <span class="d-none d-sm-block">Hapus</span>
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
function confirmDelete(userId, username) {
  document.getElementById('deleteUsername').textContent = username;
  document.getElementById('deleteForm').action = '/users/delete/' + userId;
  const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
  deleteModal.show();
}
</script>