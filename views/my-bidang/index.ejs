<!-- Alert Messages -->
<% if (typeof query !== 'undefined' && query.success) { %>
<div class="alert alert-success alert-dismissible fade show" role="alert">
  <i class="bi bi-check-circle"></i> <%= query.success %>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
<% } %>

<% if (typeof query !== 'undefined' && query.error) { %>
<div class="alert alert-danger alert-dismissible fade show" role="alert">
  <i class="bi bi-exclamation-triangle"></i> <%= query.error %>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
<% } %>

<section class="section">
  <% if (myBidang && myBidang.length > 0) { %>

  <!-- Stats Card -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card bg-gradient-primary text-white">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-8">
              <h4 class="text-white mb-2">
                <i class="bi bi-diagram-3-fill"></i> Bidang yang Anda Ikuti
              </h4>
              <p class="mb-0 opacity-75">
                Anda terdaftar sebagai anggota atau ketua di <%= myBidang.length %> bidang
              </p>
            </div>
            <div class="col-md-4 text-end">
              <div class="display-4"><%= myBidang.length %></div>
              <small>Total Bidang</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bidang Cards Grid -->
  <div class="row">
    <% myBidang.forEach(bidang => { %>
    <div class="col-md-6 col-lg-4 mb-4">
      <div class="card h-100 shadow-sm hover-card">
        <div class="card-body">
          <!-- Header with Avatar -->
          <div class="d-flex align-items-start mb-3">
            <div class="avatar avatar-xl bg-light-primary me-3">
              <span class="avatar-content">
                <i class="bi bi-diagram-3-fill fs-3 text-primary"></i>
              </span>
            </div>
            <div class="flex-grow-1">
              <h5 class="card-title mb-1"><%= bidang.nama_bidang %></h5>
              <% if (bidang.posisi) { %>
              <span class="badge <%= bidang.posisi === 'Ketua Bidang' ? 'bg-warning' : 'bg-info' %> mb-2">
                <i class="bi <%= bidang.posisi === 'Ketua Bidang' ? 'bi-star-fill' : 'bi-person' %>"></i>
                <%= bidang.posisi %>
              </span>
              <% } %>
            </div>
          </div>

          <!-- Ketua Info -->
          <div class="mb-3">
            <small class="text-muted d-block mb-1">
              <i class="bi bi-person-badge"></i> Ketua Bidang:
            </small>
            <strong class="text-primary"><%= bidang.ketua_name || 'Belum ada ketua' %></strong>
          </div>

          <!-- Description -->
          <p class="card-text text-muted mb-3" style="min-height: 60px;">
            <%= bidang.deskripsi ? (bidang.deskripsi.length > 80 ? bidang.deskripsi.substring(0, 80) + '...' : bidang.deskripsi) : 'Tidak ada deskripsi' %>
          </p>

          <!-- Action Button -->
          <% if (bidang.posisi === 'Ketua Bidang') { %>
          <a href="/my-bidang/<%= bidang.id %>" class="btn btn-warning w-100">
            <i class="bi bi-people-fill"></i> Kelola Anggota
          </a>
          <% } else { %>
          <a href="/my-bidang/<%= bidang.id %>" class="btn btn-primary w-100">
            <i class="bi bi-eye"></i> Lihat Detail
          </a>
          <% } %>
        </div>
      </div>
    </div>
    <% }); %>
  </div>

  <% } else { %>

  <!-- Empty State -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body text-center py-5">
          <div class="mb-4">
            <i class="bi bi-inbox" style="font-size: 5rem; color: #ddd;"></i>
          </div>
          <h4 class="mb-3">Belum Terdaftar di Bidang Mana Pun</h4>
          <p class="text-muted mb-4">
            Anda belum terdaftar sebagai anggota di bidang mana pun.<br>
            Hubungi Ketua Bidang atau Admin untuk mendaftar.
          </p>
          <div class="alert alert-light-info mx-auto" style="max-width: 500px;">
            <i class="bi bi-info-circle"></i>
            <strong>Info:</strong> Untuk bergabung dengan bidang, silakan hubungi Admin atau Ketua Bidang yang bersangkutan.
          </div>
        </div>
      </div>
    </div>
  </div>

  <% } %>
</section>

<script>
  // Auto dismiss alerts after 5 seconds
  setTimeout(function() {
    const alerts = document.querySelectorAll('.alert-dismissible');
    alerts.forEach(alert => {
      const bsAlert = new bootstrap.Alert(alert);
      bsAlert.close();
    });
  }, 5000);
</script>

<style>
  .hover-card {
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1) !important;
  }

  .bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .card-body {
    position: relative;
  }
</style>